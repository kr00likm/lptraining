<html>
  <head>
    <title>LP-Brand</title>
     <script src="https://lpcdn.lpsnmedia.net/webagent/client-SDK.min.js"></script>
   <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
            
  </head>
  <body>
    <h1>OMDb search</h1>
    <form class = "inputFrame">
        <input type="text" name="search" id = movie/>
        <input type="button" value="search" id="submit" />
    </form>
    
    <form class = "outputFrame">
        <input type="text" name="result" id = result/>
    </form>
    
    
     <p>This is what the user just said:</p>
        <p id="usertext"></p>
        <p>This is what the agent just said:</p>
        <p id="agenttext"></p>
    
    <p id="test" ></p> </p>
    <p id="movieTitle"></p>
    <p id="movieYear"></p>
    <p id="Director"></p>
    <p id="Plot"></p>
    <p id="test2" ></p> </p>
        <img id="Poster" src="" width="10%">
      <script>

lpTag.agentSDK.init()
var updateCallback = function(data) {
    var newLine = data.newValue;
    let usertext = document.getElementById("usertext");
    let agenttext = document.getElementById("agenttext");
    if (newLine[0].by == "Visitor") {
        usertext.innerHTML = newLine[0].text;
        const test = document.getElementById("test");
            test.innerHTML = newLine[0].text;

    } else {
        agenttext.innerHTML = newLine[0].text;
    }
};


lpTag.agentSDK.init()
var findtext = function(data) {
    var newLine = data.newValue;
    
    if (newLine[0].by == "Visitor") {
        let usertexttofind = newLine[0].text;
        const test2 = document.getElementById("test2")
        
           result =  axios.get('https://www.omdbapi.com/?t=' + usertexttofind + '&apikey=b9066cfb')
    .then(resp => {
          console.log(resp.data);
          response = resp.data;
          movieTitle.innerHTML = resp.data.Title;
        
        
            test2.innerHTML = resp.data.Title
        return usertexttofind ;
       
});



var notifyWhenDone = function(err) {
    if (err) {
        console.log(err);
    }
    console.log("set the value");
};
var pathToData = "chatTranscript.lines";
lpTag.agentSDK.bind(pathToData, updateCallback, notifyWhenDone);
lpTag.agentSDK.bind(pathToData, findtext, notifyWhenDone);         

  //const movieTitle = document.getElementById(findtext(data));
    var result ="";    
        lpTag.agentSDK.init()
    function makeGetRequest() {
      
      
       var newLine = data.newValue;
    
    if (newLine[0].by == "Visitor") {
        let usertexttofind = newLine[0].text;
        const test2 = document.getElementById("test2")
            test2.innerHTML = 'https://www.omdbapi.com/?t=' + usertexttofind + '&apikey=b9066cfb'
        return usertexttofind ;
    
      var urladdress = 'https://www.omdbapi.com/?t=joker&apikey=b9066cfb'
       
    result =  axios.get(urladdress)
    .then(resp => {
          console.log(resp.data);
          response = resp.data;
          if (resp.data.Response == "False"){
          movieTitle.innerHTML = resp.data.Error;
          } else {
          movieTitle.innerHTML = resp.data.Title;
           const movieYear = document.getElementById("movieYear");
          movieYear.innerHTML = response.Year;
           const Director = document.getElementById("Director");
          Director.innerHTML = response.Director;
           const Plot = document.getElementById("Plot");
          Plot.innerHTML = response.Plot;
          const Poster = document.getElementById("Poster");
          Poster.src = response.Poster;
          console.log(response);
          return response
          }
    })
    .catch(err => {
        // Handle Error Here
       console.error(err);
   });
      } else {
       
    }
        }
        lpTag.agentSDK.bind(pathToData, makeGetRequest, notifyWhenDone);   
      //makeGetRequest()
      
      
    </script>
       

  </body>
</html>
